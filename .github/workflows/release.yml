name: Create Release with PDF

on:
  push:
    branches: [ main ]
    paths:
      - '**.typ'

jobs:
  create-release:
    runs-on: ubuntu-latest
    permissions:
      contents: write

    steps:
    - name: Checkout repository
      uses: actions/checkout@v4

    - name: Setup Typst
      uses: typst-community/setup-typst@v3

    - name: Compile Typst document
      run: |
        typst compile main.typ template.pdf

    - name: Upload PDF as artifact
      uses: actions/upload-artifact@v4
      with:
        name: template-pdf-release
        path: template.pdf
        retention-days: 90

    - name: Get current date
      id: date
      run: echo "date=$(date +'%d/%m/%Y')" >> $GITHUB_OUTPUT

    - name: Create Release with PDF
      uses: softprops/action-gh-release@v2
      with:
        tag_name: release-${{ github.sha }}
        name: Compiled PDF ${{ steps.date.outputs.date }} (${{ github.sha }})
        body: |
          ðŸŽ“ **Template - PDF ${{ steps.date.outputs.date }} (${{ github.sha }})**

          Automated release created from main branch with the latest version of the course notes.

          **Release Details:**
          - Generated from commit: ${{ github.sha }}
          - Build date: ${{ steps.date.outputs.date }}
          - PDF compiled with latest Typst version

          **Download:** The PDF is attached to this release as `template.pdf`
        files: template.pdf
        draft: false
        prerelease: false
